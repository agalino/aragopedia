(function(c,b){var a=null;b.extend(c.Api.prototype,{postWithEditToken:function(i,f,h){var d,e,g=this;if(a===null){d=function(j){i.token=j;g.post(i,f,h)};return g.getEditToken(d,h)}else{i.token=a;e=function(k,j){if(k==="badtoken"){a=null;g.postWithEditToken(i,f,h)}else{h(k,j)}};return g.post(i,{ok:f,err:e})}},getEditToken:function(e,f){var g=b.Deferred();g.done(e);g.fail(f);this.get({action:"tokens",type:"edit"},{jsonp:false}).done(function(h){var d;if(h.tokens&&h.tokens.edittoken){d=h.tokens.edittoken;a=d;g.resolve(d)}else{g.reject("token-missing",h)}}).fail(g.reject);return g.promise()},newSection:function(g,h,f,d,e){return this.postWithEditToken({action:"edit",section:"new",format:"json",title:g.toString(),summary:h,text:f},d,e)}})}(mediaWiki,jQuery));