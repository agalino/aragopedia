(function(d){function c(f,e){return(typeof f=="function")?(f.call(e)):f}function a(e){if(e.attr("title")||typeof(e.attr("original-title"))!="string"){e.attr("original-title",e.attr("title")||"").removeAttr("title")}}function b(f,e){this.$element=d(f);this.options=e;this.enabled=true;a(this.$element)}b.prototype={show:function(){var h=this.getTitle();if(h&&this.enabled){var g=this.tip();g.find(".tipsy-inner")[this.options.html?"html":"text"](h);g[0].className="tipsy";g.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body);var k=d.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var e=g[0].offsetWidth,j=g[0].offsetHeight;var i=(typeof this.options.gravity=="function")?this.options.gravity.call(this.$element[0]):this.options.gravity;var f;switch(i.charAt(0)){case"n":f={top:k.top+k.height+this.options.offset,left:k.left+k.width/2-e/2};break;case"s":f={top:k.top-j-this.options.offset,left:k.left+k.width/2-e/2};break;case"e":f={top:k.top+k.height/2-j/2,left:k.left-e-this.options.offset};break;case"w":f={top:k.top+k.height/2-j/2,left:k.left+k.width+this.options.offset};break}if(i.length==2){if(i.charAt(1)=="w"){if(this.options.center){f.left=k.left+k.width/2-15}else{f.left=k.left}}else{if(this.options.center){f.left=k.left+k.width/2-e+15}else{f.left=k.left+k.width}}}g.css(f).addClass("tipsy-"+i);if(this.options.className){g.addClass(c(this.options.className,this.$element[0]))}if(this.options.fade){g.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity},100)}else{g.css({visibility:"visible",opacity:this.options.opacity})}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(100,function(){d(this).remove()})}else{this.tip().remove()}},getTitle:function(){var g,e=this.$element,f=this.options;a(e);var g,f=this.options;if(typeof f.title=="string"){g=e.attr(f.title=="title"?"original-title":f.title)}else{if(typeof f.title=="function"){g=f.title.call(e[0])}}g=(""+g).replace(/(^\s*|\s*$)/,"");return g||f.fallback},tip:function(){if(!this.$tip){this.$tip=d('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>')}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};d.fn.tipsy=function(i){if(i===true){return this.data("tipsy")}else{if(typeof i=="string"){return this.data("tipsy")[i]()}}i=d.extend({},d.fn.tipsy.defaults,i);function h(l){var m=d.data(l,"tipsy");if(!m){m=new b(l,d.fn.tipsy.elementOptions(l,i));d.data(l,"tipsy",m)}return m}function k(){var l=h(this);l.hoverState="in";if(i.delayIn==0){l.show()}else{setTimeout(function(){if(l.hoverState=="in"){l.show()}},i.delayIn)}}function g(){var l=h(this);l.hoverState="out";if(i.delayOut==0){l.hide()}else{setTimeout(function(){if(l.hoverState=="out"){l.hide()}},i.delayOut)}}if(!i.live){this.each(function(){h(this)})}if(i.trigger!="manual"){var e=i.live?"live":"bind",j=i.trigger=="hover"?"mouseenter":"focus",f=i.trigger=="hover"?"mouseleave":"blur";this[e](j,k)[e](f,g)}return this};d.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:true,fallback:"",gravity:"n",center:true,html:false,live:false,offset:0,opacity:1,title:"title",trigger:"hover"};d.fn.tipsy.elementOptions=function(f,e){return d.metadata?d.extend({},e,d(f).metadata()):e};d.fn.tipsy.autoNS=function(){return d(this).offset().top>(d(document).scrollTop()+d(window).height()/2)?"s":"n"};d.fn.tipsy.autoWE=function(){return d(this).offset().left>(d(document).scrollLeft()+d(window).width()/2)?"e":"w"}})(jQuery);