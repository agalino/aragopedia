(function(b,a){a(document).ready(function(){function i(){return window.FileReader!==undefined}function f(j){var k=["image/png","image/gif","image/jpeg","image/svg+xml"],l=10*1024*1024;return(a.inArray(j.type,k)!==-1)&&j.size>0&&j.size<l}function d(m){var n,k,o,j=180,l=a('<div id="mw-upload-thumbnail" class="thumb tright"><div class="thumbinner"><div class="mw-small-spinner" style="width: 180px; height: 180px"></div><div class="thumbcaption"><div class="filename"></div><div class="fileinfo"></div></div></div></div>');l.find(".filename").text(m.name).end().find(".fileinfo").text(e(m.size)).end();n=a('<canvas width="'+j+'" height="'+j+'" ></canvas>');k=n[0].getContext("2d");a("#mw-htmlform-source").parent().prepend(l);c(m,function(r){var p=new Image(),q=0;if(o&&o.tiff&&o.tiff.Orientation){q=(360-(function(){switch(o.tiff.Orientation.value){case 8:return 90;case 3:return 180;case 6:return 270;default:return 0}}()))%360}p.onload=function(){var u,s,A,z,w,C,B,t,v;if(p.width>p.height){s=j;A=p.height/p.width*j}else{A=j;s=p.width/p.height*j}C=(180-s)/2;B=(180-A)/2;switch(q){case 0:z=C;w=B;t=p.width;v=p.height;break;case 90:z=C;w=B-j;t=p.height;v=p.width;break;case 180:z=C-j;w=B-j;t=p.width;v=p.height;break;case 270:z=C-j;w=B;t=p.height;v=p.width;break}k.clearRect(0,0,180,180);k.rotate(q/180*Math.PI);k.drawImage(p,z,w,s,A);l.find(".mw-small-spinner").replaceWith(n);u=b.msg("widthheight",t,v)+", "+e(m.size);a("#mw-upload-thumbnail .fileinfo").text(u)};p.src=r},b.config.get("wgFileCanRotate")?function(p){try{o=b.libs.jpegmeta(p,m.fileName);o._binary_data=null}catch(q){o=null}}:null)}function c(l,m,k){var j=new FileReader();if(k&&"readAsBinaryString" in j){j.onload=function(){k(j.result);c(l,m)};j.readAsBinaryString(l)}else{if(k&&"readAsArrayBuffer" in j){j.onload=function(){var p,n=new Uint8Array(j.result),o="";for(p=0;p<n.byteLength;p++){o+=String.fromCharCode(n[p])}k(o);c(l,m)};j.readAsArrayBuffer(l)}else{if("URL" in window&&"createObjectURL" in window.URL){m(window.URL.createObjectURL(l))}else{j.onload=function(){m(j.result)};j.readAsDataURL(l)}}}}function e(j){var k=["size-bytes","size-kilobytes","size-megabytes","size-gigabytes"];while(j>=1024&&k.length>1){j/=1024;k=k.slice(1)}return b.msg(k[0],Math.round(j))}function h(){a("#mw-upload-thumbnail").remove()}function g(l){var m,k;function j(n){var o=b.config.get("wgMaxUploadSize");if(o[n]!==undefined){return o[n]}return o["*"]}a(".mw-upload-source-error").remove();m=j("file");if(l.size>m){k=a('<p class="error mw-upload-source-error" id="wpSourceTypeFile-error">'+b.message("largefileserver",l.size,m).escaped()+"</p>");a("#wpUploadFile").after(k);return false}return true}if(i()){a("#wpUploadFile").change(function(){h();if(this.files&&this.files.length){var j=this.files[0];if(!g(j)){return}if(f(j)){d(j)}}})}});a(document).ready(function(){var e,c,d=a(".mw-htmlform-field-UploadSourceField");function f(g){return function(){a(".mw-upload-source-error").remove();if(this.checked){d.find('input[name!="wpSourceType"]').prop("disabled",true);g.find("input").prop("disabled",false)}}}for(e=d.length;e;e--){c=d.eq(e-1);c.find('input[name="wpSourceType"]').change(f(c))}})}(mediaWiki,jQuery));