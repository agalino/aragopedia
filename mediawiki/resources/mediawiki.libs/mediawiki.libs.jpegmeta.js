(function(d){var g={};this.JpegMeta=g;g.parseNum=function m(s,x,y,v){var u;var t;var w=(s===">");if(y===undefined){y=0}if(v===undefined){v=x.length-y}for(w?u=y:u=y+v-1;w?u<y+v:u>=y;w?u++:u--){t<<=8;t+=x.charCodeAt(u)}return t};g.parseSnum=function j(s,x,y,v){var u;var t;var z;var w=(s===">");if(y===undefined){y=0}if(v===undefined){v=x.length-y}for(w?u=y:u=y+v-1;w?u<y+v:u>=y;w?u++:u--){if(z===undefined){z=(x.charCodeAt(u)&128)===128}t<<=8;t+=z?~x.charCodeAt(u)&255:x.charCodeAt(u)}if(z){t+=1;t*=-1}return t};g.Rational=function e(s,t){this.num=s;this.den=t||1;return this};g.Rational.prototype.toString=function k(){if(this.num===0){return""+this.num}if(this.den===1){return""+this.num}if(this.num===1){return this.num+" / "+this.den}return this.num/this.den};g.Rational.prototype.asFloat=function b(){return this.num/this.den};g.MetaGroup=function r(t,s){this.fieldName=t;this.description=s;this.metaProps={};return this};g.MetaGroup.prototype._addProperty=function q(v,s,u){var t=new g.MetaProp(v,s,u);this[t.fieldName]=t;this.metaProps[t.fieldName]=t};g.MetaGroup.prototype.toString=function k(){return"[MetaGroup "+this.description+"]"};g.MetaProp=function p(u,s,t){this.fieldName=u;this.description=s;this.value=t;return this};g.MetaProp.prototype.toString=function k(){return""+this.value};g.JpegFile=function l(D,s){var B=this._SOS;this.metaGroups={};this._binary_data=D;this.filename=s;var C=0;var x=0;var u;var z;var t;var y;var v;var w;var A;if(this._binary_data.slice(0,2)!==this._SOI_MARKER){throw new Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+".")}C+=2;while(C<this._binary_data.length){u=this._binary_data.charCodeAt(C++);z=this._binary_data.charCodeAt(C++);x=C;if(u!=this._DELIM){break}if(z===B){break}v=g.parseNum(">",this._binary_data,C,2);C+=v;while(C<this._binary_data.length){u=this._binary_data.charCodeAt(C++);if(u==this._DELIM){t=this._binary_data.charCodeAt(C++);if(t!=0){C-=2;break}}}y=C-x;if(this._markers[z]){w=this._markers[z][0];A=this._markers[z][1]}else{w="UNKN";A=undefined}if(A){this[A](z,x+2)}}if(this.general===undefined){throw Error("Invalid JPEG file.")}return this};this.JpegMeta.JpegFile.prototype.toString=function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"};this.JpegMeta.JpegFile.prototype._SOI_MARKER="\xff\xd8";this.JpegMeta.JpegFile.prototype._DELIM=255;this.JpegMeta.JpegFile.prototype._EOI=217;this.JpegMeta.JpegFile.prototype._SOS=218;this.JpegMeta.JpegFile.prototype._sofHandler=function n(t,s){if(this.general!==undefined){throw Error("Unexpected multiple-frame image")}this._addMetaGroup("general","General");this.general._addProperty("depth","Depth",g.parseNum(">",this._binary_data,s,1));this.general._addProperty("pixelHeight","Pixel Height",g.parseNum(">",this._binary_data,s+1,2));this.general._addProperty("pixelWidth","Pixel Width",g.parseNum(">",this._binary_data,s+3,2));this.general._addProperty("type","Type",this._markers[t][2])};this.JpegMeta.JpegFile.prototype._JFIF_IDENT="JFIF\x00";this.JpegMeta.JpegFile.prototype._JFXX_IDENT="JFXX\x00";this.JpegMeta.JpegFile.prototype._EXIF_IDENT="Exif\x00";this.JpegMeta.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]};this.JpegMeta.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition","PhotmetricInerpretation",{2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries","PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]};this.JpegMeta.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient","OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response","SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode","Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]};this.JpegMeta.JpegFile.prototype._gpstags={0:["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision","GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]};this.JpegMeta.JpegFile.prototype._markers={192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count “0”"],209:["RST1",null,"Restart with modulo 8 count “1”"],210:["RST2",null,"Restart with modulo 8 count “2”"],211:["RST3",null,"Restart with modulo 8 count “3”"],212:["RST4",null,"Restart with modulo 8 count “4”"],213:["RST5",null,"Restart with modulo 8 count “5”"],214:["RST6",null,"Restart with modulo 8 count “6”"],215:["RST7",null,"Restart with modulo 8 count “7”"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["APP13",null],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM",null],1:["JPG13",null]};this.JpegMeta.JpegFile.prototype._addMetaGroup=function c(s,t){var u=new g.MetaGroup(s,t);this[u.fieldName]=u;this.metaGroups[u.fieldName]=u;return u};this.JpegMeta.JpegFile.prototype._parseIfd=function f(M,H,x,F,E,N,J){var I=g.parseNum(M,H,x+F,2);var L,K;var t;var y;var u,w,D;var v;var C;var G;var s;var A;var z;var B;B=this._addMetaGroup(N,J);for(var L=0;L<I;L++){t=x+F+2+(L*12);y=g.parseNum(M,H,t,2);w=g.parseNum(M,H,t+2,2);v=g.parseNum(M,H,t+4,4);C=g.parseNum(M,H,t+8,4);if(this._types[w]===undefined){continue}u=this._types[w][0];D=this._types[w][1];if(D*v<=4){C=t+8}else{C=x+C}if(u=="UNDEFINED"){G=H.slice(C,C+v)}else{if(u=="ASCII"){G=H.slice(C,C+v);G=G.split("\x00")[0]}else{G=new Array();for(K=0;K<v;K++,C+=D){if(u=="BYTE"||u=="SHORT"||u=="LONG"){G.push(g.parseNum(M,H,C,D))}if(u=="SBYTE"||u=="SSHORT"||u=="SLONG"){G.push(g.parseSnum(M,H,C,D))}if(u=="RATIONAL"){A=g.parseNum(M,H,C,4);z=g.parseNum(M,H,C+4,4);G.push(new g.Rational(A,z))}if(u=="SRATIONAL"){A=g.parseSnum(M,H,C,4);z=g.parseSnum(M,H,C+4,4);G.push(new g.Rational(A,z))}G.push()}if(v===1){G=G[0]}}}if(E[y]!==undefined){B._addProperty(E[y][1],E[y][0],G)}}};this.JpegMeta.JpegFile.prototype._jfifHandler=function i(t,s){if(this.jfif!==undefined){throw Error("Multiple JFIF segments found")}this._addMetaGroup("jfif","JFIF");this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(s+5));this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(s+6));this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value);this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(s+7));this.jfif._addProperty("Xdensity","X density",g.parseNum(">",this._binary_data,s+8,2));this.jfif._addProperty("Ydensity","Y Density",g.parseNum(">",this._binary_data,s+10,2));this.jfif._addProperty("Xthumbnail","X Thumbnail",g.parseNum(">",this._binary_data,s+12,1));this.jfif._addProperty("Ythumbnail","Y Thumbnail",g.parseNum(">",this._binary_data,s+13,1))};this.JpegMeta.JpegFile.prototype._app0Handler=function a(u,t){var s=this._binary_data.slice(t,t+5);if(s==this._JFIF_IDENT){this._jfifHandler(u,t)}else{if(s==this._JFXX_IDENT){}else{}}};this.JpegMeta.JpegFile.prototype._app1Handler=function o(u,t){var s=this._binary_data.slice(t,t+5);if(s==this._EXIF_IDENT){this._exifHandler(u,t+6)}else{}};g.JpegFile.prototype._exifHandler=function h(v,C){if(this.exif!==undefined){throw new Error("Multiple JFIF segments found")}var y;var x;var u;var z,A,w;var t=this._binary_data.slice(C,C+2);if(t==="II"){y="<"}else{if(t==="MM"){y=">"}else{throw new Error("Malformed TIFF meta-data. Unknown endianess: "+t)}}x=g.parseNum(y,this._binary_data,C+2,2);if(x!==42){throw new Error("Malformed TIFF meta-data. Bad magic: "+x)}u=g.parseNum(y,this._binary_data,C+4,4);this._parseIfd(y,this._binary_data,C,u,this._tifftags,"tiff","TIFF");if(this.tiff.ExifIfdPointer){this._parseIfd(y,this._binary_data,C,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif")}if(this.tiff.GPSInfoIfdPointer){this._parseIfd(y,this._binary_data,C,this.tiff.GPSInfoIfdPointer.value,this._gpstags,"gps","GPS");if(this.gps.GPSLatitude){var B;B=this.gps.GPSLatitude.value[0].asFloat()+(1/60)*this.gps.GPSLatitude.value[1].asFloat()+(1/3600)*this.gps.GPSLatitude.value[2].asFloat();if(this.gps.GPSLatitudeRef.value==="S"){B=-B}this.gps._addProperty("latitude","Dec. Latitude",B)}if(this.gps.GPSLongitude){var s;s=this.gps.GPSLongitude.value[0].asFloat()+(1/60)*this.gps.GPSLongitude.value[1].asFloat()+(1/3600)*this.gps.GPSLongitude.value[2].asFloat();if(this.gps.GPSLongitudeRef.value==="W"){s=-s}this.gps._addProperty("longitude","Dec. Longitude",s)}}};mw.libs.jpegmeta=function(s,t){return new g.JpegFile(s,t)}})(jQuery);