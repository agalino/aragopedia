(function(a){a.suggestions={cancel:function(b){if(b.data.timerID!==null){clearTimeout(b.data.timerID)}if(a.isFunction(b.config.cancel)){b.config.cancel.call(b.data.$textbox)}},restore:function(b){b.data.$textbox.val(b.data.prevText)},update:function(d,c){function b(){if(d.data.$textbox.val().length===0){d.data.$container.hide();d.data.prevText=""}else{if(d.data.$textbox.val()!==d.data.prevText||!d.data.$container.is(":visible")){if(typeof d.config.fetch==="function"){d.data.prevText=d.data.$textbox.val();d.config.fetch.call(d.data.$textbox,d.data.$textbox.val())}}}}a.suggestions.cancel(d);if(c){d.data.timerID=setTimeout(b,d.config.delay)}else{b()}a.suggestions.special(d)},special:function(b){if(typeof b.config.special.render==="function"){setTimeout(function(){var c=b.data.$container.find(".suggestions-special");b.config.special.render.call(c,b.data.$textbox.val(),b)},1)}},configure:function(b,j,g){var n,m,f,l,o,d,c,e,h,k;switch(j){case"fetch":case"cancel":case"special":case"result":case"$region":case"expandFrom":b.config[j]=g;break;case"suggestions":b.config[j]=g;if(b.data!==undefined){if(b.data.$textbox.val().length===0){b.data.$container.hide()}else{b.data.$container.show();n={top:b.config.$region.offset().top+b.config.$region.outerHeight(),bottom:"auto",width:b.config.$region.outerWidth(),height:"auto"};b.config.expandFrom=(function(s){var u,q,t,p,r=a(document.documentElement).css("direction"),i=b.config.$region;if(b.config.positionFromLeft){s="left"}else{if(a.inArray(s,["left","right","start","end","auto"])===-1){s="auto"}}if(s==="auto"){if(i.data("searchsuggest-expand-dir")){s=i.data("searchsuggest-expand-dir")}else{u=i.outerWidth();q=a(document).width();if((u/q)>0.85){s="start"}else{t=i.offset().left+u/2;p=q/2;if(Math.abs(t-p)/p<0.1){s="start"}else{s=t>p?"right":"left"}}}}if(s==="start"){s=r==="rtl"?"right":"left"}else{if(s==="end"){s=r==="rtl"?"left":"right"}}return s}(b.config.expandFrom));if(b.config.expandFrom==="left"){n.left=b.config.$region.offset().left;n.right="auto"}else{n.left="auto";n.right=a("body").width()-(b.config.$region.offset().left+b.config.$region.outerWidth())}b.data.$container.css(n);l=b.data.$container.children(".suggestions-results");l.empty();c=-1;m=a([]);e=null;for(d=0;d<b.config.suggestions.length;d++){k=b.config.suggestions[d];f=a("<div>").addClass("suggestions-result").attr("rel",d).data("text",b.config.suggestions[d]).mousemove(function(){b.data.selectedWithMouse=true;a.suggestions.highlight(b,a(this).closest(".suggestions-results .suggestions-result"),false)}).appendTo(l);if(typeof b.config.result.render==="function"){b.config.result.render.call(f,b.config.suggestions[d],b)}else{f.append(a("<span>").css("whiteSpace","nowrap").text(k))}if(b.config.highlightInput){e=b.data.prevText}o=f.children().outerWidth();if(o>f.width()&&o>c){c=o+(b.data.$container.width()-f.width())}m=m.add(f)}if(c>b.data.$container.width()){h=b.config.maxExpandFactor*b.data.$textbox.width();b.data.$container.width(Math.min(c,h))}m.autoEllipsis({hasSpan:true,tooltip:true,matchText:e})}}break;case"maxRows":b.config[j]=Math.max(1,Math.min(100,g));break;case"delay":b.config[j]=Math.max(0,Math.min(1200,g));break;case"maxExpandFactor":b.config[j]=Math.max(1,g);break;case"submitOnClick":case"positionFromLeft":case"highlightInput":b.config[j]=g?true:false;break}},highlight:function(d,b,c){var e=d.data.$container.find(".suggestions-result-current");if(!b.get||e.get(0)!==b.get(0)){if(b==="prev"){if(e.hasClass("suggestions-special")){b=d.data.$container.find(".suggestions-result:last")}else{b=e.prev();if(!(b.length&&b.hasClass("suggestions-result"))){b=e.parents(".suggestions-results > *").prev().find(".suggestions-result").eq(0)}if(e.length===0){if(d.data.$container.find(".suggestions-special").html()!==""){b=d.data.$container.find(".suggestions-special")}else{b=d.data.$container.find(".suggestions-results .suggestions-result:last")}}}}else{if(b==="next"){if(e.length===0){b=d.data.$container.find(".suggestions-results .suggestions-result:first");if(b.length===0&&d.data.$container.find(".suggestions-special").html()!==""){b=d.data.$container.find(".suggestions-special")}}else{b=e.next();if(!(b.length&&b.hasClass("suggestions-result"))){b=e.parents(".suggestions-results > *").next().find(".suggestions-result").eq(0)}if(e.hasClass("suggestions-special")){b=a([])}else{if(b.length===0&&d.data.$container.find(".suggestions-special").html()!==""){b=d.data.$container.find(".suggestions-special")}}}}}e.removeClass("suggestions-result-current");b.addClass("suggestions-result-current")}if(c){if(b.length===0||b.is(".suggestions-special")){a.suggestions.restore(d)}else{d.data.$textbox.val(b.data("text"));d.data.$textbox.change()}d.data.$textbox.trigger("change")}},keypress:function(h,f,d){var g,c=f.data.$container.is(":visible"),b=false;switch(d){case 40:if(c){a.suggestions.highlight(f,"next",true);f.data.selectedWithMouse=false}else{a.suggestions.update(f,false)}b=true;break;case 38:if(c){a.suggestions.highlight(f,"prev",true);f.data.selectedWithMouse=false}b=c;break;case 27:f.data.$container.hide();a.suggestions.restore(f);a.suggestions.cancel(f);f.data.$textbox.trigger("change");b=c;break;case 13:f.data.$container.hide();b=c;g=f.data.$container.find(".suggestions-result-current");if(g.length===0||f.data.selectedWithMouse){a.suggestions.cancel(f);f.config.$region.closest("form").submit()}else{if(g.is(".suggestions-special")){if(typeof f.config.special.select==="function"){f.config.special.select.call(g,f.data.$textbox)}}else{if(typeof f.config.result.select==="function"){a.suggestions.highlight(f,g,true);f.config.result.select.call(g,f.data.$textbox)}else{a.suggestions.highlight(f,g,true)}}}break;default:a.suggestions.update(f,true);break}if(b){h.preventDefault();h.stopImmediatePropagation()}}};a.fn.suggestions=function(){var c,b=arguments;a(this).each(function(){var e,d;e=a(this).data("suggestions-context");if(e===undefined||e===null){e={config:{fetch:function(){},cancel:function(){},special:{},result:{},$region:a(this),suggestions:[],maxRows:7,delay:120,submitOnClick:false,maxExpandFactor:3,expandFrom:"auto",highlightInput:false}}}if(b.length>0){if(typeof b[0]==="object"){for(d in b[0]){a.suggestions.configure(e,d,b[0][d])}}else{if(typeof b[0]==="string"){if(b.length>1){a.suggestions.configure(e,b[0],b[1])}else{if(c===null||c===undefined){c=(b[0] in e.config?undefined:e.config[b[0]])}}}}}if(e.data===undefined){e.data={timerID:null,prevText:null,visibleResults:0,mouseDownOn:a([]),$textbox:a(this),selectedWithMouse:false};e.data.$container=a("<div>").css("display","none").addClass("suggestions").append(a("<div>").addClass("suggestions-results").mousedown(function(f){e.data.mouseDownOn=a(f.target).closest(".suggestions-results .suggestions-result")}).mouseup(function(h){var f=a(h.target).closest(".suggestions-results .suggestions-result"),g=e.data.mouseDownOn;e.data.mouseDownOn=a([]);if(f.get(0)!==g.get(0)){return}if(!(h.which!==1||h.altKey||h.ctrlKey||h.shiftKey||h.metaKey)){a.suggestions.highlight(e,f,true);e.data.$container.hide();if(typeof e.config.result.select==="function"){e.config.result.select.call(f,e.data.$textbox)}}e.data.$textbox.focus()})).append(a("<div>").addClass("suggestions-special").mousedown(function(f){e.data.mouseDownOn=a(f.target).closest(".suggestions-special")}).mouseup(function(h){var f=a(h.target).closest(".suggestions-special"),g=e.data.mouseDownOn;e.data.mouseDownOn=a([]);if(f.get(0)!==g.get(0)){return}if(!(h.which!==1||h.altKey||h.ctrlKey||h.shiftKey||h.metaKey)){e.data.$container.hide();if(typeof e.config.special.select==="function"){e.config.special.select.call(f,e.data.$textbox)}}e.data.$textbox.focus()}).mousemove(function(f){e.data.selectedWithMouse=true;a.suggestions.highlight(e,a(f.target).closest(".suggestions-special"),false)})).appendTo(a("body"));a(this).attr("autocomplete","off").keydown(function(f){e.data.keypressed=f.which;e.data.keypressedCount=0;switch(e.data.keypressed){case 40:f.preventDefault();f.stopImmediatePropagation();break;case 38:case 27:case 13:if(e.data.$container.is(":visible")){f.preventDefault();f.stopImmediatePropagation()}}}).keypress(function(f){e.data.keypressedCount++;a.suggestions.keypress(f,e,e.data.keypressed)}).keyup(function(f){if(e.data.keypressedCount===0){a.suggestions.keypress(f,e,e.data.keypressed)}}).blur(function(){if(e.data.mouseDownOn.length>0){return}e.data.$container.hide();a.suggestions.cancel(e)})}a(this).data("suggestions-context",e)});return c!==undefined?c:a(this)}}(jQuery));