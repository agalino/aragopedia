(function(b,a){b.Feedback=function(c){if(c===undefined){c={}}if(c.api===undefined){c.api=new b.Api()}if(c.title===undefined){c.title=new b.Title("Feedback")}if(c.dialogTitleMessageKey===undefined){c.dialogTitleMessageKey="feedback-submit"}if(c.bugsLink===undefined){c.bugsLink="//bugzilla.wikimedia.org/enter_bug.cgi"}if(c.bugsListLink===undefined){c.bugsListLink="//bugzilla.wikimedia.org/query.cgi"}a.extend(this,c);this.setup()};b.Feedback.prototype={setup:function(){var e,d,c,f=this;e=a("<a>").attr({href:f.title.getUrl(),target:"_blank"}).css({whiteSpace:"nowrap"});d=a("<a>").attr({href:"#"}).click(function(){f.displayBugs()});c=a("<a>").attr({href:f.bugsListLink,target:"_blank"});this.$dialog=a('<div style="position: relative;"></div>').append(a('<div class="feedback-mode feedback-form"></div>').append(a("<small>").append(a("<p>").msg("feedback-bugornote",d,f.title.getNameText(),e.clone())),a('<div style="margin-top: 1em;"></div>').append(b.msg("feedback-subject"),a("<br>"),a('<input type="text" class="feedback-subject" name="subject" maxlength="60" style="width: 99%;"/>')),a('<div style="margin-top: 0.4em;"></div>').append(b.msg("feedback-message"),a("<br>"),a('<textarea name="message" class="feedback-message" style="width: 99%;" rows="5" cols="60"></textarea>'))),a('<div class="feedback-mode feedback-bugs"></div>').append(a("<p>").msg("feedback-bugcheck",c)),a('<div class="feedback-mode feedback-submitting" style="text-align: center; margin: 3em 0;"></div>').append(b.msg("feedback-adding"),a("<br>"),a('<span class="feedback-spinner"></span>')),a('<div class="feedback-mode feedback-thanks" style="text-align: center; margin:1em"></div>').msg("feedback-thanks",f.title.getNameText(),e.clone()),a('<div class="feedback-mode feedback-error" style="position: relative;"></div>').append(a('<div class="feedback-error-msg style="color: #990000; margin-top: 0.4em;"></div>')));this.$dialog.find("a").css({color:"#0645ad"});this.$dialog.dialog({width:500,autoOpen:false,title:b.msg(this.dialogTitleMessageKey),modal:true,buttons:f.buttons});this.subjectInput=this.$dialog.find("input.feedback-subject").get(0);this.messageInput=this.$dialog.find("textarea.feedback-message").get(0)},display:function(c){this.$dialog.dialog({buttons:{}});this.$dialog.find(".feedback-mode").hide();this.$dialog.find(".feedback-"+c).show()},displaySubmitting:function(){this.display("submitting")},displayBugs:function(){var d=this,c={};this.display("bugs");c[b.msg("feedback-bugnew")]=function(){window.open(d.bugsLink,"_blank")};c[b.msg("feedback-cancel")]=function(){d.cancel()};this.$dialog.dialog({buttons:c})},displayThanks:function(){var d=this,c={};this.display("thanks");c[b.msg("feedback-close")]=function(){d.$dialog.dialog("close")};this.$dialog.dialog({buttons:c})},displayForm:function(e){var d=this,c={};this.subjectInput.value=(e&&e.subject)?e.subject:"";this.messageInput.value=(e&&e.message)?e.message:"";this.display("form");c[b.msg("feedback-submit")]=function(){d.submit()};c[b.msg("feedback-cancel")]=function(){d.cancel()};this.$dialog.dialog({buttons:c})},displayError:function(e){var d=this,c={};this.display("error");this.$dialog.find(".feedback-error-msg").msg(e);c[b.msg("feedback-close")]=function(){d.$dialog.dialog("close")};this.$dialog.dialog({buttons:c})},cancel:function(){this.$dialog.dialog("close")},submit:function(){var d,g,f=this;function c(h){if(h.edit!==undefined){if(h.edit.result==="Success"){f.displayThanks()}else{f.displayError("feedback-error1")}}else{f.displayError("feedback-error2")}}function e(){f.displayError("feedback-error3")}d=this.subjectInput.value;g=this.messageInput.value;if(g.indexOf("~~~")===-1){g+=" ~~~~"}this.displaySubmitting();this.api.newSection(this.title,d,g,c,e)},launch:function(c){this.displayForm(c);this.$dialog.dialog("open");this.subjectInput.focus()}}}(mediaWiki,jQuery));